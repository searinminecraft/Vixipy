{% extends "layouts/default.html" %}
{% block title %}Settings{% endblock %}

{% block content %}

<h1>Settings</h1>

<hr>

{% if not g.isAuthorized %}

<h1>Log in to your pixiv account</h1>
<p>Log in to your pixiv account to get a personalised feed and the ability to like and bookmark posts. To do this, you must get your pixiv PHPSESSID cookie. See the guide <a href="https://pixivfe-docs.pages.dev/obtaining-pixivfe-token/" rel="noopener noreferrer">from PixivFE</a> for details. Your token is stored locally and will not be stored on the server.</p>

<form action="/settings/token" method="POST">
	<input type="text" placeholder="PHPSESSID" name="token" autocomplete="off" required="true"></input>
	<button type="submit" value="Log in">Log in</button>
</form>

{% else %}

<h1>Log out</h1>
<p>Click on the button below to securely log out.</p>

<form action="/settings/logout">
	<button type="submit">Log out</button>
</form>

{% endif %}
<br>
<hr>

<h1>General</h1>

<form action="/settings/setPref" method="POST">
	{% set hideAIPref = (request.cookies.get('PyXivHideAI') == '1') %}
	{% set hideR18Pref = (request.cookies.get('PyXivHideR18') == '1') %}
	<label>
		<input type="checkbox" name="hideAI" {% if hideAIPref %}checked{% endif %}>
		Hide AI Generated artworks
	</label>
	<label>
		<input type="checkbox" name="hideR18" {% if hideR18Pref %}checked{% endif %}>
		Hide R-18/R-18G artworks
	</label>
	<br>
	<button type="submit">Save preferences</button>
</form>

<br>
<hr>

<h1>Proxy server</h1>
<p>A pixiv image proxy server allows you to access images from pixiv without your device making any connection to pixiv servers.</p>

<p>PyXiv has a built-in proxy server, but if you don't like it or if you find it too slow (it may just be the instance owner's/vps' network connection :p), you can specify one below. Only images from the domain <code>i.pximg.net</code> will use the specified proxy server.</p>
<br>
<p>Your current preferred proxy server: {{ g.userProxyServer}}</p>

<form action="/settings/imgproxy" method="POST">
	<label>
		<input type="radio" name="image-proxy" required="true" value>
		Use built-in proxy server (should be reliable enough)
	</label>
	<label>
		<input type="radio" name="image-proxy" required="true" value="https://pximg.exozy.me">
		https://pximg.exozy.me
	</label>
	<label>
		<input type="radio" name="image-proxy" required="true" value="https://i.pixiv.re">
		https://i.pixiv.re
	</label>
	<br>
	<button type="submit">Use selected proxy</button>
</form>

<h2>Custom proxy server</h2>
<p>You can specify a custom image proxy here.</p>
<h3>Examples</h3>

<ul>
	<li>https://pximg.exozy.me</li>
	<li>http://localhost:5000/proxy/i.pximg.net</li>
</ul>

<form action="/settings/imgproxy" method="POST">
	<input type="text" name="image-proxy" autocomplete="off" required="true"></input>
	<button type="submit">Use proxy server</button>
</form>
{% endblock %}
