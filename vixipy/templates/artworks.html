{% extends "layouts/default.html" %}
{% set title = work.alt %}

{% import "components/artwork-entry.html" as artwork_entry %}

{% block content %}
<main>
    <section id="artwork-main">
        <main>
            {% if work.isUgoira %}
            <video src="/proxy/ugoira/{{work.id}}" loop playsinline autoplay controls poster="{{pages[0].reg}}"></video>
            {% else %}
            <div class="works">
                {% for p in pages %}
                <div class="work">
                    <div class="meta">
                        <div>{{p.width}}x{{p.height}}</div>
                        {% if pages | length > 1 %}
                        <div>{{p.page}}/{{work.pages}}</div>
                        {% endif %}
                    </div>
                    <a href="{{p.orig}}" target="_blank">
                        <img src="{{p.reg}}" alt="{{_('Page %(page)d of %(total)d', page=p.page, total=pages|length)}}">
                    </a>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            <div class="userdata">
                <div class="author">
                    <div class="author-main">
                        <a class="author-link" href="/users/{{work.authorId}}">
                            <img src="{{user.image}}" alt="{{work.authorName}}">
                            {{work.authorName}}
                        </a>
                        {% if g.authorized %}
                        <form action="/self/action/user/{{user.id}}/{% if not user.followed %}follow{% else %}unfollow{% endif %}"
                            hx-push-url="false" hx-swap="outerHTML show:none" hx-target="this" hx-indicator="this"
                            hx-headers='{"X-Vixipy-Quick-Action": "true"}' method="post">
                            <input type="hidden" name="return_to" value="{{request.path}}">
                            <button type="submit" class="button {%if not user.followed%}primary{%else%}neutral{%endif%}">
                                {%if not user.followed%}{{_("Follow")}}{%else%}{{_("Unfollow")}}{% endif %}
                            </button>
                        </form>
                        {% endif %}
                    </div>
                    <a href="/users/{{work.authorId}}">{{_("View all works")}}</a>
                </div>
                <div class="scrolling-container">
                    {% for w in user_works %}
                    {{ artwork_entry.entry(w, false, false, true) }}
                    {% endfor %}
                </div>
            </div>
        </main>
        <aside>
            <h2>{{work.title}}</h2>
            <ul class="tags">
                {% for t in work.tags %}
                <li><a href="/tags/{{t.name}}">#{{t.name}}</a> {{t.en or t.romaji or ""}}</li>
                {% endfor %}
            </ul>
            {% if work.xrestrict >= 1 %}
            <p class="sl-warn">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e3e3e3"><path d="M109-120q-11 0-20-5.5T75-140q-5-9-5.5-19.5T75-180l370-640q6-10 15.5-15t19.5-5q10 0 19.5 5t15.5 15l370 640q6 10 5.5 20.5T885-140q-5 9-14 14.5t-20 5.5H109Zm371-120q17 0 28.5-11.5T520-280q0-17-11.5-28.5T480-320q-17 0-28.5 11.5T440-280q0 17 11.5 28.5T480-240Zm0-120q17 0 28.5-11.5T520-400v-120q0-17-11.5-28.5T480-560q-17 0-28.5 11.5T440-520v120q0 17 11.5 28.5T480-360Z"/></svg>
                {{work.xrestrict_friendlyname}}
            </p>
            {% endif %}
            {% if work.sensitive and not work.xrestrict >= 1 %}
            <p class="sl-warn">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e3e3e3"><path d="M109-120q-11 0-20-5.5T75-140q-5-9-5.5-19.5T75-180l370-640q6-10 15.5-15t19.5-5q10 0 19.5 5t15.5 15l370 640q6 10 5.5 20.5T885-140q-5 9-14 14.5t-20 5.5H109Zm371-120q17 0 28.5-11.5T520-280q0-17-11.5-28.5T480-320q-17 0-28.5 11.5T440-280q0 17 11.5 28.5T480-240Zm0-120q17 0 28.5-11.5T520-400v-120q0-17-11.5-28.5T480-560q-17 0-28.5 11.5T440-520v120q0 17 11.5 28.5T480-360Z"/></svg>
                {{_("Sensitivity Level: %(sl)d", sl=work.sl)}}
            </p>
            {% endif %}
            <ul class="data">
                <li>
                    {% if g.authorized %}
                    <form action="/self/action/{%if work.bookmarked%}delete_bookmark/{{work.bookmark_id}}{%else%}works/{{work.id}}/bookmark{%endif%}" method="post"
                    hx-swap="outerHTML show:none" hx-target="this" hx-push-url="false" hx-indicator="this"
                    hx-headers='{"X-Vixipy-Quick-Action": "true"}'>
                        <input type="hidden" name="return_to" value="{{request.path}}">
                        <input type="hidden" name="bookmark_count" value="{{work.bookmarkCount}}">
                        <input type="hidden" name="work_id" value="{{work.id}}">
                        <button type="submit">
                            {% if work.bookmarked %}
                            <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="#e3e3e3"><path d="m480-170.93-36.15-32.69q-98.46-88.23-162.5-150.57-64.04-62.35-100.58-109.93-36.54-47.57-50.65-86.27Q116-589.08 116-629q0-80.15 55.42-135.58Q226.85-820 307-820q49.38 0 95 23.5t78 67.27q32.38-43.77 78-67.27 45.62-23.5 95-23.5 80.15 0 135.58 55.42Q844-709.15 844-629q0 39.92-13.62 77.61-13.61 37.7-50.15 84.77-36.54 47.08-100.89 110.43Q615-292.85 514.15-201.62L480-170.93Z"/></svg>
                            {% else %}
                            <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="#e8eaed"><path d="M479.62-194.62q-11.85 0-22.81-4.11-10.96-4.12-20.81-12.96l-47.46-43.23q-109.38-97-190.96-187.58Q116-533.08 116-634q0-79.17 54.27-132.58Q224.55-820 305-820q46.58 0 92.18 21.31 45.59 21.31 82.82 72.46 39.23-51.15 84.08-72.46Q608.94-820 654.68-820q80.47 0 134.9 53.42Q844-713.17 844-634q0 102.08-83.5 193.23-83.5 91.15-189.04 185.46l-47.85 43.62q-9.84 8.84-20.99 12.96-11.16 4.11-23 4.11Zm-24.39-475.84q-27.46-49.46-66.35-73.5Q350-768 305-768q-58.71 0-97.86 38Q168-692 168-633.61q0 46.76 30.04 96.8t75.42 100.46q45.38 50.43 98.58 97.96 53.19 47.54 99.88 89.08 3.46 3.08 8.08 3.08t8.08-3.08q46.69-41.54 99.88-89.08 53.2-47.53 98.58-97.96 45.38-50.42 75.42-100.46Q792-586.85 792-633.61 792-692 752.86-730q-39.15-38-97.86-38-45 0-84.38 24.04-39.39 24.04-66.85 73.5-3.08 7.69-9.82 11.04-6.74 3.34-14 3.34t-14.45-3.34q-7.19-3.35-10.27-11.04ZM480-506.54Z"/></svg>
                            {% endif %}
                            {{work.bookmarkCount}}
                        </button>
                    </form>
                    {% else %}
                    <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="#e8eaed"><path d="M479.62-194.62q-11.85 0-22.81-4.11-10.96-4.12-20.81-12.96l-47.46-43.23q-109.38-97-190.96-187.58Q116-533.08 116-634q0-79.17 54.27-132.58Q224.55-820 305-820q46.58 0 92.18 21.31 45.59 21.31 82.82 72.46 39.23-51.15 84.08-72.46Q608.94-820 654.68-820q80.47 0 134.9 53.42Q844-713.17 844-634q0 102.08-83.5 193.23-83.5 91.15-189.04 185.46l-47.85 43.62q-9.84 8.84-20.99 12.96-11.16 4.11-23 4.11Zm-24.39-475.84q-27.46-49.46-66.35-73.5Q350-768 305-768q-58.71 0-97.86 38Q168-692 168-633.61q0 46.76 30.04 96.8t75.42 100.46q45.38 50.43 98.58 97.96 53.19 47.54 99.88 89.08 3.46 3.08 8.08 3.08t8.08-3.08q46.69-41.54 99.88-89.08 53.2-47.53 98.58-97.96 45.38-50.42 75.42-100.46Q792-586.85 792-633.61 792-692 752.86-730q-39.15-38-97.86-38-45 0-84.38 24.04-39.39 24.04-66.85 73.5-3.08 7.69-9.82 11.04-6.74 3.34-14 3.34t-14.45-3.34q-7.19-3.35-10.27-11.04ZM480-506.54Z"/></svg>
                    {{work.bookmarkCount}}
                    {% endif %}
                </li>
                <li>
                    {% if g.authorized %}
                    {% if work.liked %}
                    <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="#e3e3e3"><path d="M709.23-164H257.08v-440l273.38-271.84L546.3-870q17.24 12.23 25.35 30.5 8.12 18.27 3.12 37.35V-806L538.3-604h289.39q26.54 0 45.42 18.89Q892-566.23 892-539.69v41.61q0 7.23-1.31 12.96t-3.92 11.97L773.15-205.69q-8.61 19.23-25.84 30.46T709.23-164ZM205.08-604v440H68v-440h137.08Z"/></svg>
                    {{work.likeCount}}
                    {% else %}
                    <form action="/self/action/works/{{work.id}}/like" method="post"
                        hx-swap="outerHTML show:none" hx-target="this" hx-push-url="false"
                        hx-headers='{"X-Vixipy-Quick-Action": "true"}'>
                        <input type="hidden" name="return_to" value="{{request.path}}">
                        <input type="hidden" name="like_count" value="{{work.likeCount}}">
                        <button type="submit">
                            <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="#e3e3e3"><path d="M709.23-164H272.46v-440l273.39-271.84 15.84 5.84q16.23 11.23 24.85 28 8.61 16.77 4.61 34.85l-1 1.15-36.46 202h274q26.54 0 45.42 18.89Q892-566.23 892-539.69v41.61q0 7.23-1.12 12.96-1.11 5.73-4.11 11.97L773.08-205.49q-8.54 19.03-25.77 30.26T709.23-164Zm-384.77-52h384.77q4.23 0 8.65-2.31 4.43-2.31 6.74-7.69L840-495v-44.69q0-5.39-3.46-8.85t-8.85-3.46H491.85L537-794.23 324.46-582.46V-216Zm0-366.46V-216v-366.46Zm-52-21.54v52H120v336h152.46v52H68v-440h204.46Z"/></svg>
                            {{work.likeCount}}
                        </button>
                    </form>
                    {% endif %}
                    {% else %}
                    <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="#e3e3e3"><path d="M709.23-164H272.46v-440l273.39-271.84 15.84 5.84q16.23 11.23 24.85 28 8.61 16.77 4.61 34.85l-1 1.15-36.46 202h274q26.54 0 45.42 18.89Q892-566.23 892-539.69v41.61q0 7.23-1.12 12.96-1.11 5.73-4.11 11.97L773.08-205.49q-8.54 19.03-25.77 30.26T709.23-164Zm-384.77-52h384.77q4.23 0 8.65-2.31 4.43-2.31 6.74-7.69L840-495v-44.69q0-5.39-3.46-8.85t-8.85-3.46H491.85L537-794.23 324.46-582.46V-216Zm0-366.46V-216v-366.46Zm-52-21.54v52H120v336h152.46v52H68v-440h204.46Z"/></svg>
                    {{work.likeCount}}
                    {% endif %}
                </li>
                <li>
                    <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="#e8eaed"><path d="M480.09-328.92q62.99 0 106.99-44.09 44-44.09 44-107.08 0-62.99-44.09-106.99-44.09-44-107.08-44-62.99 0-106.99 44.09-44 44.09-44 107.08 0 62.99 44.09 106.99 44.09 44 107.08 44ZM480-384q-40 0-68-28t-28-68q0-40 28-68t68-28q40 0 68 28t28 68q0 40-28 68t-68 28Zm0 172q-122.31 0-225.54-64.89-103.23-64.88-165.69-170.8-5-7.62-6.81-15.64-1.8-8.02-1.8-16.46 0-8.44 1.8-16.67 1.81-8.23 6.81-15.85 62.46-105.92 165.69-170.8Q357.69-748 480-748q122.31 0 225.54 64.89 103.23 64.88 165.69 170.8 5 7.62 6.81 15.64 1.8 8.02 1.8 16.46 0 8.44-1.8 16.67-1.81 8.23-6.81 15.85-62.46 105.92-165.69 170.8Q602.31-212 480-212Z"/></svg>
                    {{work.viewCount}}
                </li>
                <li>
                    <a href="{{url_for('artworks.get_comments', id=work.id)}}" target="_blank">
                        <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="#e8eaed"><path d="M851.69-243q3.08 31.69-23.34 45.23-26.43 13.54-46.51-6.54l-70.9-70.98H360.03q-25.91 0-44.35-18.47-18.45-18.47-18.45-44.4v-32.61h379.39q26.52 0 45.41-18.89 18.89-18.89 18.89-45.42V-672h32.62q25.89 0 44.33 18.45 18.44 18.45 18.44 44.36v381.96q0-6.93 4.61-11.35 4.62-4.42 10.77-4.42Zm-676-200.15 51.62-51.62h377.31q5.38 0 8.84-3.46t3.46-8.85v-272.61q0-5.39-3.46-8.85t-8.84-3.46H188q-5.38 0-8.85 3.46-3.46 3.46-3.46 8.85v336.54Zm-19.79 80.3q-12.13 0-22.17-8.15-10.04-8.16-10.04-23.79v-384.9q0-26.53 18.89-45.42T188-844h416.62q26.52 0 45.41 18.89 18.89 18.89 18.89 45.42v272.61q0 26.53-18.89 45.42t-45.41 18.89H249.23l-71.07 71.08q-4.94 4.61-10.57 6.73-5.62 2.11-11.69 2.11Zm19.79-144.23V-792v284.92Z"/></svg>
                        {{work.commentCount}}
                    </a>
                </li>
            </ul>
            <p class="create-date">{{work.uploadDate|datetimeformat('MMMM dd, yyyy hh:mm')}}</p>
        </aside>
    </section>

    <section id="related">
        <h2>{{_("Related works")}}</h2>
        {% if recommend | length > 0 %}
        <div class="artwork-container">
            {% for r in recommend %}
            {{ artwork_entry.entry(r) }}
            {% endfor %}
        </div>
        {% else %}
        <p>{{_("No recommended works to show.")}}</p>
        {% endif %}
    </section>
</main>
{% endblock %}